#!/bin/bash
# Mock Claude for testing nigel

set -e

DELAY="${MOCK_CLAUDE_DELAY:-3}"
PROMPT=""

# Parse -p flag
while [[ $# -gt 0 ]]; do
    case "$1" in
        -p)
            PROMPT="$2"
            shift 2
            ;;
        *)
            shift
            ;;
    esac
done

# Extract candidate from prompt
CANDIDATE=$(echo "$PROMPT" | grep -oP 'Fix the issue: \K\S+' || echo "unknown")

sleep "$DELAY"

# Output with tuning info
echo "[mock-claude] Processed '$CANDIDATE' in ${DELAY}s"
echo ""
echo "Tuning: MOCK_CLAUDE_DELAY=${DELAY}s  MOCK_CLAUDE_FIX=${MOCK_CLAUDE_FIX:-0}"

if [[ "$MOCK_CLAUDE_FIX" == "1" ]]; then
    touch ".fixed-${CANDIDATE}"
    echo "Result: Fixed"
else
    echo "Result: Not fixed"
fi
